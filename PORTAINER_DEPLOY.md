# üöÄ –î–µ–ø–ª–æ–π –≤ Portainer

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è Docker –¥–µ–ø–ª–æ—è
‚úÖ –ü–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω —Å 8847 –Ω–∞ **8563** (—Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
‚úÖ Docker Compose —Ñ–∞–π–ª –≥–æ—Ç–æ–≤
‚úÖ Dockerfile –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

---

## üìã –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –≤ Portainer

### –í–∞—Ä–∏–∞–Ω—Ç 1: Stack (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞–π–¥–∏—Ç–µ –≤ **Portainer** ‚Üí **Stacks** ‚Üí **Add stack**
2. –ù–∞–∑–æ–≤–∏—Ç–µ stack: `subtitle-translator`
3. –í—ã–±–µ—Ä–∏—Ç–µ:
   - **Repository** ‚Üí —É–∫–∞–∂–∏—Ç–µ –≤–∞—à Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - –ò–ª–∏ **Upload** ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç–µ `docker-compose.yml`
   - –ò–ª–∏ **Web editor** ‚Üí –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `docker-compose.yml`
4. –í **Environment variables** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```
   PORT=8563
   OLLAMA_NUM_PARALLEL=2
   OLLAMA_MAX_LOADED_MODELS=1
   ```
5. –ù–∞–∂–º–∏—Ç–µ **Deploy the stack**

### –í–∞—Ä–∏–∞–Ω—Ç 2: Custom template

1. **App Templates** ‚Üí **Custom Templates** ‚Üí **Add Custom Template**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Title**: Subtitle Translator
   - **Description**: Ollama subtitle translator with web UI
   - **Type**: Stack (Compose)
   - **Build method**: Web editor
   - –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `docker-compose.yml`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ

---

## üîß –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
–í Portainer –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à stack –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- ‚úÖ `ollama` - running
- ‚úÖ `translator` - running
- ‚ö†Ô∏è `model-init` - stopped (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –æ–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏)

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
**–í–∞–∂–Ω–æ:** –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫):
```bash
# –í Portainer: Containers ‚Üí model-init ‚Üí Logs
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
‚úÖ –ú–æ–¥–µ–ª—å translategemma:4b –∑–∞–≥—Ä—É–∂–µ–Ω–∞!
üöÄ –ì–æ—Ç–æ–≤–æ! –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.
```

### 3. –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: **http://localhost:8563**

–ò–ª–∏ –µ—Å–ª–∏ Portainer –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ:
**http://<IP-–∞–¥—Ä–µ—Å-—Å–µ—Ä–≤–µ—Ä–∞>:8563**

---

## üìä –†–µ—Å—É—Ä—Å—ã

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **RAM**: 8GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 16GB)
- **Disk**: ~3GB (–º–æ–¥–µ–ª—å + –æ–±—Ä–∞–∑—ã)
- **CPU**: –õ—é–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã:
- **8563** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞
- **11434** - Ollama API (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

### Volumes:
- `ollama_data` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π Ollama

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
–í Portainer: Stack ‚Üí **Stop** ‚Üí **Start**

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ stack
2. –£–¥–∞–ª–∏—Ç–µ stack
3. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º

### –£–¥–∞–ª–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏
–í Portainer:
1. Stack ‚Üí **Stop** ‚Üí **Remove**
2. Volumes ‚Üí –ù–∞–π–¥–∏—Ç–µ `ollama_data` ‚Üí **Remove**

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
sudo ufw allow from 127.0.0.1 to any port 8563

# –ò–ª–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
sudo ufw allow from 192.168.0.0/24 to any port 8563
```

### –û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (Nginx):
```nginx
server {
    listen 80;
    server_name subtitle.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:8563;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # –î–ª—è WebSocket (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

---

## üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Portainer ‚Üí Stack ‚Üí Environment variables:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `PORT` | –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç | `8563` |
| `OLLAMA_URL` | URL Ollama API | `http://ollama:11434` |
| `MAX_WORKERS` | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ | `3` |
| `FILE_TTL` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ñ–∞–π–ª–æ–≤ (—Å–µ–∫) | `86400` |
| `TASK_TTL` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–¥–∞—á (—Å–µ–∫) | `86400` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `INFO` |

---

## üÜò –ü—Ä–æ–±–ª–µ–º—ã

### Model-init –æ—à–∏–±–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `model-init` –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í Portainer: Containers ‚Üí model-init ‚Üí Logs
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
# Containers ‚Üí model-init ‚Üí Restart
```

### Translator –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `translator` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 8563 —Å–≤–æ–±–æ–¥–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: Containers ‚Üí translator ‚Üí Logs
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (—Å–º. –ª–æ–≥–∏ model-init)

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–≤–æ–¥ –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤ docker-compose.yml:**
```yaml
environment:
  - OLLAMA_NUM_PARALLEL=1  # –£–º–µ–Ω—å—à–∏—Ç–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ RAM
  - OLLAMA_MAX_LOADED_MODELS=1
  - MAX_WORKERS=2  # –ú–µ–Ω—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] Docker Desktop –∑–∞–ø—É—â–µ–Ω
- [ ] Portainer –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ú–∏–Ω–∏–º—É–º 8GB —Å–≤–æ–±–æ–¥–Ω–æ–π RAM
- [ ] ~3GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- [ ] –ü–æ—Ä—Ç—ã 8563 –∏ 11434 —Å–≤–æ–±–æ–¥–Ω—ã
- [ ] –§–∞–π–ª—ã `docker-compose.yml`, `Dockerfile`, `init-model.sh` –≤ –ø—Ä–æ–µ–∫—Ç–µ
- [ ] –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω (–¥–ª—è –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏)

---

**üéâ –ì–æ—Ç–æ–≤–æ! –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8563 –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã.**
